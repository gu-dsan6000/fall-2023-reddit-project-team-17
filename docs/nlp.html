<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>It's Storytime! – nlp</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">It’s Storytime!</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" rel="" target="" aria-current="page">
 <span class="menu-text">Main</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./secondary/code-and-data.html" rel="" target="">
 <span class="menu-text">Code and Data</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./secondary/authors.html" rel="" target="">
 <span class="menu-text">Authors</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./secondary/references.html" rel="" target="">
 <span class="menu-text">References</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./nlp.html">NLP</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">EDA</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nlp.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">NLP</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ML</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./conclusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conclusion</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./discussion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Feedback Discussion</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#executive-summary" id="toc-executive-summary" class="nav-link active" data-scroll-target="#executive-summary">Executive summary</a></li>
  <li><a href="#analysis-report" id="toc-analysis-report" class="nav-link" data-scroll-target="#analysis-report">Analysis Report</a>
  <ul class="collapse">
  <li><a href="#sec-flair-sentiment-model" id="toc-sec-flair-sentiment-model" class="nav-link" data-scroll-target="#sec-flair-sentiment-model">Flair Sentiment Model</a></li>
  <li><a href="#sec-extracting-age-and-gender" id="toc-sec-extracting-age-and-gender" class="nav-link" data-scroll-target="#sec-extracting-age-and-gender">Extracting the age and gender of the author of the post</a></li>
  <li><a href="#sec-nlp-with-countvectorizer" id="toc-sec-nlp-with-countvectorizer" class="nav-link" data-scroll-target="#sec-nlp-with-countvectorizer">NLP with <code>CountVectorizer</code></a></li>
  <li><a href="#sec-preparing-covid-19-data" id="toc-sec-preparing-covid-19-data" class="nav-link" data-scroll-target="#sec-preparing-covid-19-data">Preparing Covid-19 data in <code>NoStupidQuestions</code></a></li>
  <li><a href="#sec-rnn-data-preparation" id="toc-sec-rnn-data-preparation" class="nav-link" data-scroll-target="#sec-rnn-data-preparation">Preparing Reddit and External Data for Training an RNN</a></li>
  <li><a href="#sec-data-storage" id="toc-sec-data-storage" class="nav-link" data-scroll-target="#sec-data-storage">Data Storage</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">NLP</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="executive-summary" class="level2">
<h2 class="anchored" data-anchor-id="executive-summary">Executive summary</h2>
<p>This section outlines the NLP procedures conducted for the project. We performed a comprehensive sentiment analysis on Reddit’s r/AmItheA*hole, revealing a dominant negative sentiment across posts, regardless of their flairs, and a correlation between positive sentiments and higher user engagement. Additional analysis of demographics showed varied sentiment distributions across age and gender. We also extend the analysis to multi-class classification on Reddit, aiming to predict authors’ age and gender using NLP and ML techniques. We found that post sentiments varied minimally across age groups, predominantly featuring negative sentiments, with a significant concentration in the 18-25 age bracket. Gender analysis echoed this trend, with negative sentiments dominating all identified genders, as numerically validated by the gender sentiment distribution table. Furthermore, the data preparation for machine learning involved cleaning and transforming text through <code>CountVectorizer</code>, focusing on the most frequent words.</p>
<p>After identifying “NoStupidQuestions” as the subreddit that we would investigate for topics related to Covid-19 trends we created a plot that should convey its interest over time in this particular subreddit. Separately, the research integrated Reddit submissions with classic literature texts, employing detailed NLP transformations and data filtering. This preparation will facilitate the development of the input data to train a recurrent neural network (RNN) that will generate new story submissions.</p>
<p>All sections used johnsnowlabs <code>sparkNLP</code> to perform the text analysis. Please see the links to the <code>.ipynb</code> notebooks in each section for the specific implementation.</p>
</section>
<section id="analysis-report" class="level2">
<h2 class="anchored" data-anchor-id="analysis-report">Analysis Report</h2>
<section id="sec-flair-sentiment-model" class="level3">
<h3 class="anchored" data-anchor-id="sec-flair-sentiment-model">Flair Sentiment Model</h3>
<p>In this section we explored the textual content of the posts of r/AmItheA*hole (r/AITA) with respect to their assigned flairs and subsequently applying a pretrained sentiment model. Using a sparkNLP pipeline, all text posts from r/AITA in 2022 with one of the four primary flairs (A*hole, Not the A*hole, Everybody Sucks, No A*holes Here) attached were processed/cleaned and run through a pretrained sentiment model. The sentiment model most commonly assigned these posts a “negative” sentiment, as shown in <a href="#fig-flair-sentiments-barchart">Figure&nbsp;1</a>. This holds true across posts assigned any of the four primary flairs.</p>
<div id="fig-flair-sentiments-barchart" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/nlp-plots/flair_sentiments_barchart.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;1: Shows the subreddit sentiment by flair.</figcaption>
</figure>
</div>
<p>To further delve into the sentiments of these posts in r/AITA, we analyzed these sentiment assignments with respect to the engagement a post receives, represented by the number of comments under each posts. In the <a href="#fig-flair-engagements-barchart">Figure&nbsp;2</a>, the mean number of comments per post grouped by flair assignment and sentiment assignment.</p>
<div id="fig-flair-engagements-barchart" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/nlp-plots/flair_engagements_barchart.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;2: Shows the subreddit engagement by flair.</figcaption>
</figure>
</div>
<p>From this plot above, we can extract several conclusions. We can see that posts assigned the “A*hole” flair receive the most user engagement (on average) and posts assigned “No A-holes here” receive the least engagement, on average. Additionally, it is apparent that posts assigned a “negative” sentiment receive less user engagement than those with a “positive” sentiment across all four primary flairs. Thus, it is possible there could be a relationship wherein the more “positive” a post’s sentiment/writing is, the more likely it is to receive more engagement (at least in the form of number of comments).</p>
<p><a href="#tbl-aita-sentiment-engagements">Table&nbsp;1</a> below is a numerical representation of <a href="#fig-flair-engagements-barchart">Figure&nbsp;2</a> showing the average number of comments per post by flair and sentiment assignment.</p>
<div class="cell tbl-cap-location-bottom" data-execution_count="2">
<div class="cell-output cell-output-display" data-execution_count="2">
<div id="tbl-aita-sentiment-engagements" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;1: Displays the r/AITA subreddit sentiment engagements.</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Flair</th>
<th style="text-align: right;">Negative</th>
<th style="text-align: right;">Neutral</th>
<th style="text-align: right;">Positive</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Asshole</td>
<td style="text-align: right;">242.2</td>
<td style="text-align: right;">225.59</td>
<td style="text-align: right;">265.44</td>
</tr>
<tr class="even">
<td style="text-align: left;">Everyone Sucks</td>
<td style="text-align: right;">104.88</td>
<td style="text-align: right;">172.31</td>
<td style="text-align: right;">183.61</td>
</tr>
<tr class="odd">
<td style="text-align: left;">No A-holes here</td>
<td style="text-align: right;">63.15</td>
<td style="text-align: right;">67.74</td>
<td style="text-align: right;">90.92</td>
</tr>
<tr class="even">
<td style="text-align: left;">Not the A-hole</td>
<td style="text-align: right;">105.07</td>
<td style="text-align: right;">128.07</td>
<td style="text-align: right;">148.4</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>The code used for this section is available <a href="https://github.com/gu-dsan6000/fall-2023-reddit-project-team-17/blob/main/code/project-nlp/flairs-nlp.ipynb">here</a>.</p>
</div>
</div>
</div>
</section>
<section id="sec-extracting-age-and-gender" class="level3">
<h3 class="anchored" data-anchor-id="sec-extracting-age-and-gender">Extracting the age and gender of the author of the post</h3>
<p>In using NLP and ML techniques to predict the age and gender of the author who created a post, it’s important to observe the distribution of ages and genders as they relate to other variables of interest. In particular, it can be interesting to observe these variables as they relate to post sentiment. Note that the age and gender of the author of the post is not provided in the dataset and is instead extracted from the post itself using regex, if available.</p>
<p>In <a href="#fig-sentiment-age">Figure&nbsp;3</a> we can see a density plot of the age of the author of a post, grouped by the categorized sentiment of the post itself. We find that there doesn’t seem to be much of a difference between the distribution of ages for each sentiment, as each seems to peak around ages between 18 and 25 years old. Furthermore, we can clearly see that the vast majority of posts contain negative sentiment - likely posts written about negative experiences and asking for advice.</p>
<div id="fig-sentiment-age" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/nlp-plots/predicting-subreddits-density-age.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;3: Shows how age is distributed across sentiment</figcaption>
</figure>
</div>
<p>We can visualize similar features regarding the identified gender of the author of a post in <a href="#fig-sentiment-gender">Figure&nbsp;4</a>. Here, we can see the distribution of categorized sentiment of posts, grouped by the identified gender of the author of the post. Again, we find that the distribution of sentiments across genders is relatively similar, with the vast majority of posts containing negative sentiment.</p>
<div id="fig-sentiment-gender" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/nlp-plots/predicting-subreddits-density-gender.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;4: Shows how gender is distributed across sentiment</figcaption>
</figure>
</div>
<p><a href="#tbl-gender-table">Table&nbsp;2</a> represents the same data as above, but expresses the relative frequencies of categorized post sentiment, grouped by the author’s identified gender. Here, we find numerically that the distribution of sentiments is very similar across genders, with negative sentiments making up almost 95% of instances for all genders.</p>
<div class="cell tbl-cap-location-bottom" data-execution_count="3">
<div class="cell-output cell-output-display" data-execution_count="3">
<div id="tbl-gender-table" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;2: Displays the distribution of sentiment across genders.</caption>
<thead>
<tr class="header">
<th style="text-align: right;">Female</th>
<th style="text-align: right;">Male</th>
<th style="text-align: right;">Other</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">0.93</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.02</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.05</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="sec-nlp-with-countvectorizer" class="level3">
<h3 class="anchored" data-anchor-id="sec-nlp-with-countvectorizer">NLP with <code>CountVectorizer</code></h3>
<p>In order to incorporate NLP-based predictors in a machine learning model, we first have to process the content of each reddit post such that it can appropriately be fed into the model. Importantly, textual data cannot be sent directly into a machine learning model - we must represent the text numerically such that it can be interpreted by the model. One way in which we do this is by identifying how many times each word is used in each post.</p>
<p>In preparing the data for machine learning models, we first want to clean the textual data before we represent it numerically. In doing so, we opt to perform the following cleaning steps:</p>
<ul>
<li>Remove all special characters, retaining only alphabetic characters and spaces: This will help us focus only on the words used, rather than any punctuation present.</li>
<li>Convert the text to lowercase: This will help us standardize word usage by interpreting capitalized and non-capitalized words as the same.</li>
<li>Tokenize the text: This will help us break down posts into their individual word tokens, rather than maintaining one long document.</li>
<li>Remove “stop words”: This will help us remove extremely common words, such as “a” and “and”, so that we can focus more on the selective vocabulary that each author uses.</li>
<li>Stem and lemmatize words: This will help us take different variations of the same word, such as “run”, “running”, and “ran”, and reduce them into the stem of the word (“run”).</li>
</ul>
<p>In performing these cleaning steps, we obtain representations of the textual components of each post that we can begin to represent numerically. To do this, we conduct a few more steps:</p>
<ul>
<li>Calculate word frequencies: This will help us obtain a numeric representation for each word within each document - the number of time it occurs.</li>
<li>Subset to the “n” most frequent words across all documents: This will help us filter out very uncommon words, including, but not limited to, misspelled words.</li>
</ul>
<p>By obtaining word frequencies and subsetting the vocabulary to a more manageable size, we can retain a large portion of the total words used, while greatly reducing the search space with respect to our vocabulary. For instance, the top 10% most frequent words used might make up 80% of the total words used, with most words being used very infrequently (Zipf’s Law).</p>
<p><a href="#tbl-count-vectorizer-dataframe-preview">Table&nbsp;3</a> is a glimpse at what our transformed dataset looks like as it prepares to be sent into a machine learning model. We obtain “n” columns - one for each of the “n” most frequent words - with values representing the frequency with which they appear in each document. These features can be combined with other features of the data, such as the number of comments associated with a post, to form a feature set suitable for a machine learning model.</p>
<div class="cell tbl-cap-location-bottom" data-execution_count="4">
<div class="cell-output cell-output-display" data-execution_count="4">
<div id="tbl-count-vectorizer-dataframe-preview" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;3: Displays a preview of the CountVectorized submissions data.</caption>
<colgroup>
<col style="width: 17%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 9%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Subreddit</th>
<th style="text-align: right;">‘like’</th>
<th style="text-align: right;">‘feel’</th>
<th style="text-align: right;">‘want’</th>
<th style="text-align: right;">‘know’</th>
<th style="text-align: right;">‘time’</th>
<th style="text-align: right;">‘tell’</th>
<th style="text-align: right;">‘get’</th>
<th style="text-align: right;">‘im’</th>
<th style="text-align: right;">‘think’</th>
<th style="text-align: right;">‘friend’</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">antiwork</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">unpopularopinion</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AmItheAsshole</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">NoStupidQuestions</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TrueOffMyChest</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">relationship_advice</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">relationship_advice</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">NoStupidQuestions</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">relationship_advice</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">relationship_advice</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>The code used for this section is available <a href="https://github.com/gu-dsan6000/fall-2023-reddit-project-team-17/blob/main/code/project-nlp/project-nlp-predicting-subreddits.ipynb">here</a>.</p>
</div>
</div>
</div>
</section>
<section id="sec-preparing-covid-19-data" class="level3">
<h3 class="anchored" data-anchor-id="sec-preparing-covid-19-data">Preparing Covid-19 data in <code>NoStupidQuestions</code></h3>
<p>After performing NLP on the <code>NoStupidQuestions</code> subreddit to find longer posts related to COVID-19 for later Machine-Learning-related work. We wanted to visualize the interest over time to see if anything stood out or if there were recognizable trends. From <a href="#fig-covid-nsq">Figure&nbsp;5</a>, we can see a couple of large spikes in interest. The parquet file should capture these spikes and will be a great place to perform our Machine Learning summarization.</p>
<div id="fig-covid-nsq" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/nlp-plots/covid-nsq.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;5: Shows how gender is distributed across sentiment</figcaption>
</figure>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>The code used for this section is available <a href="https://github.com/gu-dsan6000/fall-2023-reddit-project-team-17/blob/main/code/project-nlp/topics-nlp.ipynb">here</a>.</p>
</div>
</div>
</div>
</section>
<section id="sec-rnn-data-preparation" class="level3">
<h3 class="anchored" data-anchor-id="sec-rnn-data-preparation">Preparing Reddit and External Data for Training an RNN</h3>
<p>For this exercise, we focused on preparing text that contains great storytelling to train a Recurrent Neural Network (RNN) that can generate new stories. We use our 12 months of Reddit submissions data described in the EDA section for the analysis. Additionally, we integrate external data containing the text of famous stories from Project Gutenberg books that have stood the test of time, specifically <em>The Scarlet Letter</em> by Nathaniel Hawthorne <span class="citation" data-cites="hawthorne_scarlet_2008">[<a href="#ref-hawthorne_scarlet_2008" role="doc-biblioref">1</a>]</span>, <em>The Odyssey</em> by Homer <span class="citation" data-cites="homer_odyssey_1999">[<a href="#ref-homer_odyssey_1999" role="doc-biblioref">2</a>]</span>, <em>Crime and Punishment</em> by Fyodor Dostoyevsky <span class="citation" data-cites="dostoyevsky_crime_2006">[<a href="#ref-dostoyevsky_crime_2006" role="doc-biblioref">3</a>]</span>, <em>Metamorphosis</em> by Franz Kafka <span class="citation" data-cites="kafka_metamorphosis_2005">[<a href="#ref-kafka_metamorphosis_2005" role="doc-biblioref">4</a>]</span>, and <em>The Great Gatsby</em> by F. Scott Fitzgerald <span class="citation" data-cites="fitzgerald_great_2021">[<a href="#ref-fitzgerald_great_2021" role="doc-biblioref">5</a>]</span>. While the stories retrieved from Reddit have high scores, adding books from external sources makes sure that out training data will contain story telling that has stood the test of time and trascended generations. This may make the model more likely to output better, more compelling output.</p>
<p>To prepare the Reddit data, we extracted only the relevant information from the parquets, such as <code>subreddit</code>, <code>title</code>, <code>selftext</code>, <code>score</code>, and <code>URL</code>, and filtered out deleted or empty submissions. To select the best stories, we used a regular expressions pattern to remove any “Edit:” sections to remove post-edit additions that could skew the analysis. Since stories must be at least a few paragraphs, we removed all posts that didn’t have at least 4,500 characters (around 750 words). Then, we filtered for only stored with <code>score</code> in the top 85th percentile, thereby focusing on submissions that garnered significant user interaction.</p>
<p>We then combined the text sources. The data underwent a series of NLP transformations, including custom tokenization and lowercasing, to prepare it for advanced analysis. We constructed a vocabulary and transformed the individual characters into tokens. The resulting frequency of each token is shown in <a href="#fig-token-frequency-plot">Figure&nbsp;6</a>. Lastly, we stored the processed data in a structured Parquet format alongside the character-to-index mappings, crucial for the subsequent machine-learning modeling.</p>
<div id="fig-token-frequency-plot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="img/nlp-plots/books-and-stories-token-frequency-plot.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;6: Shows the count of the Top 10 tokens</figcaption>
</figure>
</div>
<p>As an additionally way to visualize the resulting dataset, we also can see the results of the top 10 N-Grams, where <span class="math inline">\(N=5\)</span> in <a href="#tbl-n-gram-results">Table&nbsp;4</a>.</p>
<div class="cell tbl-cap-location-bottom" data-execution_count="5">
<div class="cell-output cell-output-display" data-execution_count="5">
<div id="tbl-n-gram-results" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;4: displays the top 10 most frequent N-Grams where <span class="math inline">\(N=5\)</span>.</caption>
<thead>
<tr class="header">
<th style="text-align: left;">5-Gram (incl spaces)</th>
<th style="text-align: left;">Count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">i was</td>
<td style="text-align: left;">22,165</td>
</tr>
<tr class="even">
<td style="text-align: left;">and i</td>
<td style="text-align: left;">17,933</td>
</tr>
<tr class="odd">
<td style="text-align: left;">in the</td>
<td style="text-align: left;">15,264</td>
</tr>
<tr class="even">
<td style="text-align: left;">of the</td>
<td style="text-align: left;">13,807</td>
</tr>
<tr class="odd">
<td style="text-align: left;">that i</td>
<td style="text-align: left;">11,631</td>
</tr>
<tr class="even">
<td style="text-align: left;">to be</td>
<td style="text-align: left;">10,346</td>
</tr>
<tr class="odd">
<td style="text-align: left;">it was</td>
<td style="text-align: left;">10,172</td>
</tr>
<tr class="even">
<td style="text-align: left;">to the</td>
<td style="text-align: left;">9,418</td>
</tr>
<tr class="odd">
<td style="text-align: left;">i had</td>
<td style="text-align: left;">8,307</td>
</tr>
<tr class="even">
<td style="text-align: left;">i dont</td>
<td style="text-align: left;">8,212</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>The code used for this section is available <a href="https://github.com/gu-dsan6000/fall-2023-reddit-project-team-17/blob/main/code/project-nlp/project-nlp-posts-and-books-generate.ipynb">here</a>.</p>
</div>
</div>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>The external data is available <a href="https://github.com/gu-dsan6000/fall-2023-reddit-project-team-17/tree/main/data/external-data/books">here</a>.</p>
</div>
</div>
</div>
</section>
<section id="sec-data-storage" class="level3">
<h3 class="anchored" data-anchor-id="sec-data-storage">Data Storage</h3>
<p>Outputs of the NLP cleaning procedures are stored in <code>.parquet</code> the team bucket <code>s3a://project17-bucket-alex/</code> for ease of use with ML models.</p>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body" role="list">
<div id="ref-hawthorne_scarlet_2008" class="csl-entry" role="listitem">
<div class="csl-left-margin">[1] </div><div class="csl-right-inline">Hawthorne N, Foote MH, Ipsen LS. The <span>Scarlet</span> <span>Letter</span>. 2008. <a href="https://www.gutenberg.org/ebooks/25344">https://www.gutenberg.org/ebooks/25344</a></div>
</div>
<div id="ref-homer_odyssey_1999" class="csl-entry" role="listitem">
<div class="csl-left-margin">[2] </div><div class="csl-right-inline">Homer. The <span>Odyssey</span>. Butler S, translator. 1999. <a href="https://www.gutenberg.org/ebooks/1727">https://www.gutenberg.org/ebooks/1727</a></div>
</div>
<div id="ref-dostoyevsky_crime_2006" class="csl-entry" role="listitem">
<div class="csl-left-margin">[3] </div><div class="csl-right-inline">Dostoyevsky F. Crime and <span>Punishment</span>. Garnett C, translator. 2006. <a href="https://www.gutenberg.org/ebooks/2554">https://www.gutenberg.org/ebooks/2554</a></div>
</div>
<div id="ref-kafka_metamorphosis_2005" class="csl-entry" role="listitem">
<div class="csl-left-margin">[4] </div><div class="csl-right-inline">Kafka F. Metamorphosis. Wyllie D(Translator), translator. 2005. <a href="https://www.gutenberg.org/ebooks/5200">https://www.gutenberg.org/ebooks/5200</a></div>
</div>
<div id="ref-fitzgerald_great_2021" class="csl-entry" role="listitem">
<div class="csl-left-margin">[5] </div><div class="csl-right-inline">Fitzgerald FS(FrancisS. The <span>Great</span> <span>Gatsby</span>. 2021. <a href="https://www.gutenberg.org/ebooks/64317">https://www.gutenberg.org/ebooks/64317</a></div>
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">A project by Team 17.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Made with and <a href="https://quarto.org/">Quarto</a><br> <a href="https://github.com/gu-dsan6000/fall-2023-reddit-project-team-17">View the source at GitHub</a></div>
  </div>
</footer>



</body></html>